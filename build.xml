<?xml version="1.0" encoding="UTF-8"?>

<project name="www.besmart.info" default="build">

    <target name="build"
         depends="prepare,lint,composer,phpunit,apigen"/>

    <target name="clean" description="Cleanup build artifacts">
        <delete dir="${basedir}/build/coverage"/>
        <delete dir="${basedir}/build/logs"/>
        <delete dir="${basedir}/build/doc"/>
    </target>

    <target name="prepare" depends="clean" description="Prepare for build">
        <mkdir dir="${basedir}/build/coverage"/>
        <mkdir dir="${basedir}/build/logs"/>
        <mkdir dir="${basedir}/build/doc"/>
    </target>

    <target name="lint" description="Perform syntax check of sourcecode files">
        <apply executable="php" failonerror="true">
            <arg value="-l" />

            <fileset dir="${basedir}/src">
                <include name="**/*.php" />
                <modified />
            </fileset>

        </apply>
    </target>

    <target name="composer" description="Install vendor dependencies">
        <exec executable="composer" failonerror="true">
            <arg value="install" />
        </exec>
    </target>

    <target name="phpunit" description="Run unit tests with PHPUnit">
        <exec executable="phpunit" failonerror="true">
            <arg value="-c" />
            <arg path="${basedir}/app/" />
        </exec>
    </target>

    <target name="apigen" description="Generate documentation using apigen">
        <exec executable="apigen">
            <arg value="--config" />
            <arg path="${basedir}/apigen.neon" />
            <arg value="--update-check no" />
        </exec>
    </target>
</project>
